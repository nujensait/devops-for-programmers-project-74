FROM node:20.12.2
WORKDIR /app

# Копируем файлы зависимостей
COPY ./app/package.json ./app/package-lock.json ./

# Устанавливаем зависимости (используем npm install вместо ci для большей гибкости)
RUN npm install --omit=dev

# Копируем остальные файлы
COPY ./app .

EXPOSE 8080
ENV NODE_ENV=production
RUN make build

CMD ["make", "start"]